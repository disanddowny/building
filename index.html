<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë°˜ì§€í•˜ 2033 ê´‘ê¸°ì˜ íŠ¸ëŸ­</title>
    <style>
        :root {
            --primary-color: #3a3a3c;
            --secondary-color: #2c2c2e;
            --accent-color: #ff9500;
            --text-color: #f5f5f7;
            --border-color: #515154;
            --danger-color: #ff3b30;
            --success-color: #34c759;
            --warning-color: #ffcc00;
            --info-color: #5ac8fa;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: var(--primary-color);
            color: var(--text-color);
            padding: 20px;
            max-width: 1000px;
            margin: 0 auto;
        }
        
        .game-container {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
        }
        
        .resources-panel {
            background-color: var(--secondary-color);
            border-radius: 8px;
            padding: 15px;
            border: 1px solid var(--border-color);
            margin-bottom: 20px;
        }
        
        .resource-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }
        
        .resource-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(0,0,0,0.2);
            padding: 8px 12px;
            border-radius: 4px;
        }
        
        .resource-icon {
            width: 24px;
            height: 24px;
            margin-right: 8px;
            display: inline-block;
            text-align: center;
        }
        
        .resource-value {
            font-weight: bold;
            color: var(--accent-color);
        }
        
        h1, h2, h3 {
            margin-bottom: 15px;
            color: var(--accent-color);
        }
        
        .characters-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .character-card {
            background-color: var(--secondary-color);
            border-radius: 8px;
            padding: 15px;
            border: 1px solid var(--border-color);
            position: relative;
        }
        
        .character-card.dead {
            opacity: 0.6;
            background-color: #222;
        }
        
        .character-name {
            font-size: 1.2em;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .selected-action {
            font-size: 0.8em;
            color: var(--accent-color);
            margin-left: 8px;
        }
        
        .character-trait {
            font-size: 0.9em;
            margin-bottom: 10px;
            font-style: italic;
            color: #aaa;
        }
        
        .status-labels {
            display: flex;
            gap: 5px;
            margin-bottom: 10px;
        }
        
        .status-label {
            font-size: 0.8em;
            padding: 3px 8px;
            border-radius: 4px;
            background-color: var(--danger-color);
        }
        
        .status-label.depressed {
            background-color: var(--warning-color);
            color: black;
        }
        
        .status-label.injured {
            background-color: var(--danger-color);
        }
        
        .status-label.dead {
            background-color: black;
        }
        
        .actions-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }
        
        .action-button {
            padding: 8px;
            border: none;
            border-radius: 4px;
            background-color: #515154;
            color: white;
            cursor: pointer;
            transition: background-color 0.2s;
            position: relative;
        }
        
        .action-button:hover {
            background-color: #6d6d70;
        }
        
        .action-button:disabled {
            background-color: #3a3a3c;
            color: #8e8e93;
            cursor: not-allowed;
        }
        
        .action-tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0,0,0,0.9);
            padding: 8px 12px;
            border-radius: 4px;
            width: 200px;
            z-index: 100;
            display: none;
            font-size: 0.85em;
            line-height: 1.4;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }
        
        .action-button:hover .action-tooltip {
            display: block;
        }
        
        .game-panel {
            background-color: var(--secondary-color);
            border-radius: 8px;
            padding: 15px;
            border: 1px solid var(--border-color);
        }
        
        .end-turn-container {
            margin-top: 20px;
            text-align: center;
        }
        
        .end-turn-button {
            padding: 12px 24px;
            background-color: var(--accent-color);
            color: black;
            border: none;
            border-radius: 4px;
            font-weight: bold;
            cursor: pointer;
            font-size: 1.1em;
        }
        
        .end-turn-button:disabled {
            background-color: #8e8e93;
            cursor: not-allowed;
        }
        
        .message-log {
            background-color: rgba(0,0,0,0.2);
            border-radius: 8px;
            padding: 15px;
            height: 200px;
            overflow-y: auto;
            margin-top: 20px;
            border: 1px solid var(--border-color);
        }
        
        .message {
            margin-bottom: 10px;
            line-height: 1.4;
            padding-left: 10px;
            border-left: 3px solid var(--border-color);
        }
        
        .continue-button {
            margin-top: 10px;
            padding: 8px 16px;
            background-color: var(--accent-color);
            color: black;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .game-status {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
        }
        
        .game-status-item {
            font-weight: bold;
        }
        
        .progress-container {
            height: 20px;
            background-color: rgba(0,0,0,0.2);
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 15px;
        }
        
        .progress-bar {
            height: 100%;
            background-color: var(--success-color);
            transition: width 0.3s ease;
        }
        
        .progress-bar.defense {
            background-color: var(--info-color);
        }
        
        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .modal-content {
            background-color: var(--primary-color);
            padding: 20px;
            border-radius: 8px;
            max-width: 500px;
            text-align: center;
        }
        
        .modal-title {
            font-size: 1.5em;
            margin-bottom: 15px;
        }
        
        .modal-button {
            padding: 10px 20px;
            margin-top: 20px;
            background-color: var(--accent-color);
            color: black;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>ë°˜ì§€í•˜ 2033 ê´‘ê¸°ì˜ íŠ¸ëŸ­</h1>
    
    <div class="game-container">
        <div class="left-panel">
            <div class="resources-panel">
                <h2>ìì›</h2>
                <div class="resource-grid">
                    <div class="resource-item">
                        <div><span class="resource-icon">ğŸ¥©</span> ê³ ê¸°</div>
                        <div class="resource-value" id="meat-value">3</div>
                    </div>
                    <div class="resource-item">
                        <div><span class="resource-icon">ğŸ¥•</span> ì•¼ì±„</div>
                        <div class="resource-value" id="vegetables-value">3</div>
                    </div>
                    <div class="resource-item">
                        <div><span class="resource-icon">ğŸ”§</span> ë¶€í’ˆ</div>
                        <div class="resource-value" id="parts-value">0</div>
                    </div>
                    <div class="resource-item">
                        <div><span class="resource-icon">ğŸº</span> ìˆ </div>
                        <div class="resource-value" id="alcohol-value">0</div>
                    </div>
                </div>
            </div>
            
            <div class="game-panel">
                <div class="game-status">
                    <div class="game-status-item">ë‚ ì§œ: <span id="day-value">1</span>ì¼ì°¨ <span id="time-period">ë‚®</span></div>
                </div>
                
                <div class="progress-label">
                    <span>íŠ¸ëŸ­ ë‚´êµ¬ë„</span>
                    <span id="truck-value">0%</span>
                </div>
                <div class="progress-container">
                    <div class="progress-bar" id="truck-bar" style="width: 0%;"></div>
                </div>
                
                <div class="progress-label">
                    <span>ìº í”„ ë°©ì–´ë„</span>
                    <span id="defense-value">100%</span>
                </div>
                <div class="progress-container">
                    <div class="progress-bar defense" id="defense-bar" style="width: 100%;"></div>
                </div>
                
                <div class="end-turn-container">
                    <button id="end-turn-button" class="end-turn-button">í„´ ì¢…ë£Œ</button>
                </div>
            </div>
            
            <div class="message-log" id="message-log">
                <div class="message">íŠ¸ëŸ­ì„ íƒ€ê³  íí—ˆ ì„œìš¸ì„ ì‹ ë‚˜ê²Œ ëˆ„ë¹„ë˜ ë°˜ì§€í•˜ íŒ¨ê±°ë¦¬! ê·¸ëŸ¬ë‚˜ ê°‘ìê¸° íŠ¸ëŸ­ì´ ê³ ì¥ë‚˜ë©° ì™¸ë”´ ê³³ì— ë©ˆì¶”ê³  ë§ì•˜ìŠµë‹ˆë‹¤. ìœ„í—˜í•œ ì„¸ë ¥ì´ ë®ì¹˜ê¸° ì „ì— íŠ¸ëŸ­ì„ ìˆ˜ë¦¬í•˜ê³  ë– ë‚˜ì•¼ í•©ë‹ˆë‹¤.</div>
            </div>
        </div>
        
        <div class="characters-container" id="characters-container">
            <!-- ìºë¦­í„° ì¹´ë“œë“¤ì´ JavaScriptë¡œ ë™ì  ìƒì„±ë©ë‹ˆë‹¤ -->
        </div>
    </div>
    
    <div id="game-over-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <h2 class="modal-title" id="modal-title">ê²Œì„ ì¢…ë£Œ</h2>
            <p id="modal-message">ëª¨ë“  ìƒì¡´ìê°€ ì£½ì—ˆìŠµë‹ˆë‹¤.</p>
            <button class="modal-button" onclick="restartGame()">ë‹¤ì‹œ ì‹œì‘</button>
        </div>
    </div>
    
    <div id="night-events-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <h2 class="modal-title">ë°¤ ì´ë²¤íŠ¸</h2>
            <p id="night-event-message"></p>
            <button class="modal-button" id="continue-night-button">ê³„ì†</button>
        </div>
    </div>
    
    <script>
        // ê²Œì„ ìƒíƒœ
        const gameState = {
            day: 1,
            isNight: false,
            truckDurability: 0,
            defenseFortification: 5, // ê¸°ë³¸ ë°©ì–´ë„ ì¦ê°€ëŸ‰
            defense: 100,
            resources: {
                meat: 3,
                vegetables: 3,
                parts: 0,
                alcohol: 0
            },
            characters: [
                {
                    id: 'yoonji',
                    name: 'ì •ìœ¤ì§€',
                    trait: 'ê³ ê¸°ëŠ” ëª» ë¨¹ê³  ì•¼ì±„ë§Œ ë¨¹ì„ ìˆ˜ ìˆë‹¤',
                    action: null,
                    injured: false,
                    depressed: false,
                    dead: false,
                    happy: false
                },
                {
                    id: 'seohyun',
                    name: 'ì‹ ì„œí˜„',
                    trait: 'ìˆ˜ë¦¬ íš¨ê³¼ê°€ 2ë°°ê°€ ëœë‹¤',
                    action: null,
                    injured: false,
                    depressed: false,
                    dead: false,
                    happy: false
                },
                {
                    id: 'pilgeun',
                    name: 'ì°¨í•„ê·¼',
                    trait: 'íŒŒí‹° ì¤€ë¹„ë¥¼ í•  ìˆ˜ ìˆë‹¤',
                    action: null,
                    injured: false,
                    depressed: false,
                    dead: false,
                    preparingParty: false,
                    happy: false
                },
                {
                    id: 'sungkook',
                    name: 'ì˜¤ì„±êµ­',
                    trait: 'í•˜ë£¨ì— ì‹ëŸ‰ 2ê°œë¥¼ ì†Œë¹„í•œë‹¤',
                    action: null,
                    injured: false,
                    depressed: false,
                    dead: false,
                    happy: false
                }
            ],
            nightMessages: [],
            currentMessageIndex: 0
        };

        // í–‰ë™ ì •ì˜
        const actions = {
            repair: {
                name: 'íŠ¸ëŸ­ ìˆ˜ë¦¬',
                description: 'íŠ¸ëŸ­ ë‚´êµ¬ë„ë¥¼ ì¦ê°€ì‹œí‚¨ë‹¤. ğŸ”§ë¶€í’ˆì„ ì“¸ ìˆ˜ ìˆë‹¤.',
                isAvailable: (character) => !character.dead,
                execute: (character) => {
                    let prefix = '';
                    let bonus = 0;
                    if (character.happy) {
                        prefix = '(ì‹±ê¸€ë²™ê¸€) ';
                        bonus = 1;
                    }
                    let repairAmount = 1 + bonus;
                    // ë¶€í’ˆë‹¹ ì¶”ê°€ ìˆ˜ë¦¬
                  
                    // ì„œí˜„ì€ ìˆ˜ë¦¬ íš¨ê³¼ 2ë°° (ê¸°ë³¸ ìˆ˜ë¦¬ëŸ‰ê³¼ ë¶€í’ˆ íš¨ê³¼ ëª¨ë‘ í¬í•¨)
                    if (character.id === 'seohyun') {
                        repairAmount *= 2;
                    }  
                    let partMessage = '';
                    if (gameState.resources.parts > 0) {
                        repairAmount += gameState.resources.parts;
                        gameState.resources.parts -= 1;
                        partMessage = 'ë¶€í’ˆìœ¼ë¡œ ';
                    }
                    gameState.truckDurability += repairAmount;
                    return `${prefix}${partMessage}íŠ¸ëŸ­ì„ ìˆ˜ë¦¬í•´ì„œ ë‚´êµ¬ë„ë¥¼ ${repairAmount}% ì¦ê°€ì‹œì¼°ì–´.`;
                }
            },
            forest: {
                name: 'ìˆ² ë³´ë‚´ê¸°',
                description: 'ìˆ²ì—ì„œ ì‹ëŸ‰ì„ ì°¾ì•„ë³¸ë‹¤.',
                isAvailable: (character) => !character.dead && !character.injured,
                execute: (character) => {
                    let prefix = '';
                    if (character.happy) prefix = '(ì‹±ê¸€ë²™ê¸€) ';
                    // ìœ¤ì§€ëŠ” ì•¼ì±„ë§Œ 0-5ê°œ ê°€ì ¸ì˜´
                    if (character.id === 'yoonji') {
                        let min = character.happy ? 1 : 0;
                        const vegetablesFound = Math.floor(Math.random() * (6 - min)) + min; // min~5
                        gameState.resources.vegetables += vegetablesFound;
                        return `${prefix}ìˆ²ì— ê°€ì„œ ì•¼ì±„ ${vegetablesFound}ê°œë¥¼ ê°€ì ¸ì™”ì–´.`;
                    } else {
                        let min = character.happy ? 1 : 0;
                        const meatFound = Math.floor(Math.random() * (3 - min)) + min; // min~2
                        const vegetablesFound = Math.floor(Math.random() * (3 - min)) + min; // min~2
                        gameState.resources.meat += meatFound;
                        gameState.resources.vegetables += vegetablesFound;
                        return `${prefix}ìˆ²ì— ê°€ì„œ ê³ ê¸° ${meatFound}ê°œ, ì•¼ì±„ ${vegetablesFound}ê°œë¥¼ ê°€ì ¸ì™”ì–´.`;
                    }
                }
            },
            ruins: {
                name: 'íí—ˆ ë³´ë‚´ê¸°',
                description: 'í˜í—ˆì—ì„œ ì“¸ë§Œí•œ ê±¸ ì°¾ì•„ë³¸ë‹¤.',
                isAvailable: (character) => !character.dead && !character.injured,
                execute: (character) => {
                    let prefix = '';
                    if (character.happy) prefix = '(ì‹±ê¸€ë²™ê¸€) ';
                    let min = character.happy ? 1 : 0;
                    const partsFound = Math.floor(Math.random() * (2 - min)) + min; // min~1
                    const alcoholFound = Math.floor(Math.random() * (2 - min)) + min; // min~1
                    gameState.resources.parts += partsFound;
                    gameState.resources.alcohol += alcoholFound;
                    let message = `${prefix}íí—ˆì— ê°€ì„œ ë¶€í’ˆ ${partsFound}ê°œ, ìˆ  ${alcoholFound}ê°œë¥¼ ê°€ì ¸ì™”ì–´.`;
                    // 50% í™•ë¥ ë¡œ ë¶€ìƒ
                    if (Math.random() < 0.5) {
                        character.injured = true;
                        message += " í•˜ì§€ë§Œ ë¶€ìƒì„ ì…ì—ˆì–´.";
                    }
                    return message;
                }
            },
            blackmarket: {
                name: 'ì•”ì‹œì¥ ë³´ë‚´ê¸°',
                description: 'ğŸºìˆ  1ê°œë¥¼ ì†Œëª¨í•´ ğŸ¥©ê³ ê¸°ë¥¼ êµ¬í•œë‹¤.',
                isAvailable: (character) => !character.dead && !character.injured && gameState.resources.alcohol > 0,
                execute: (character) => {
                    let prefix = '';
                    if (character.happy) prefix = '(ì‹±ê¸€ë²™ê¸€) ';
                    gameState.resources.alcohol -= 1;
                    let min = character.happy ? 3 : 2;
                    const meatFound = Math.floor(Math.random() * (6 - min + 1)) + min; // min~6
                    gameState.resources.meat += meatFound;
                    let message = `${prefix}ì•”ì‹œì¥ì— ê°€ì„œ ìˆ  1ê°œë¥¼ ê³ ê¸° ${meatFound}ê°œë¡œ ë°”ê¿”ì™”ì–´.`;
                    // 50% í™•ë¥ ë¡œ ì‚¬ê¸°ê¾¼ì„ ë§Œë‚˜ ë¶€ìƒ
                    if (Math.random() < 0.5) {
                        character.injured = true;
                        message += " ê·¼ë° ê±°ë˜ ëë‚˜ê³  ë’¤ì—ì„œ ì´ì„ ì˜ë”ë¼ê³ .";
                    }
                    return message;
                }
            },
            nurse: {
                name: 'ê°„í˜¸',
                description: 'ìº í”„ì— ìˆëŠ” ë‹¤ë¥¸ ëª¨ë“  ë¶€ìƒìì˜ ë¶€ìƒì„ íšŒë³µì‹œí‚¨ë‹¤.',
                isAvailable: (character) => {
                    // ìºë¦­í„°ê°€ ê°„í˜¸í•  ìˆ˜ ìˆëŠ” ìƒíƒœì¸ì§€ í™•ì¸
                    if (character.dead || character.injured || character.depressed) return false;
                    
                    // ê°„í˜¸í•  ë¶€ìƒìê°€ ìˆëŠ”ì§€ í™•ì¸
                    let hasInjured = false;
                    gameState.characters.forEach(c => {
                        if (c.id !== character.id && c.injured && !c.dead) {
                            hasInjured = true;
                        }
                    });
                    return hasInjured;
                },
                execute: (character) => {
                    let healedCharacters = [];
                    
                    gameState.characters.forEach(c => {
                        if (c.id !== character.id && c.injured && !c.dead) {
                            c.injured = false;
                            healedCharacters.push(c.name);
                        }
                    });
                    
                    return `ë¶€ìƒë‹¹í•œ ${healedCharacters.join(', ')}ë¥¼ ê°„í˜¸í–ˆì–´.`;
                }
            },
            rest: {
                name: 'íœ´ì‹',
                description: 'ìì‹ ì˜ ìš°ìš¸ì„ ì¹˜ë£Œí•œë‹¤.',
                isAvailable: (character) => !character.dead && character.depressed,
                execute: (character) => {
                    setDepressed(character, false);
                    return "íœ´ì‹ì„ ì·¨í•´ì„œ ë§ˆìŒì´ í¸ì•ˆí•´ì¡Œì–´.";
                }
            },
            guard: {
                name: 'ê²½ê³„',
                description: 'ìº í”„ì˜ ë°©ì–´ë„ë¥¼ ì˜¬ë¦°ë‹¤.',
                isAvailable: (character) => !character.dead && !character.injured && gameState.defense < 100,
                execute: (character) => {
                    let prefix = '';
                    let bonus = 0;
                    if (character.happy) {
                        prefix = '(ì‹±ê¸€ë²™ê¸€) ';
                        bonus = 1;
                    }
                    gameState.defense += gameState.defenseFortification + bonus;
                    if (gameState.defense > 100) gameState.defense = 100;
                    return `${prefix}ê²½ê³„ë¥¼ ì„œì„œ ìº í”„ì˜ ë°©ì–´ë„ë¥¼ ${gameState.defenseFortification + bonus}% ì˜¬ë ¸ì–´.`;
                }
            },
            party: {
                name: 'íŒŒí‹° ì¤€ë¹„',
                description: 'ğŸºìˆ  1ê°œë¥¼ ì†Œëª¨í•´ ë°¤ì— ìˆì„ íŒŒí‹°ë¥¼ ì¤€ë¹„í•œë‹¤.',
                isAvailable: (character) => character.id === 'pilgeun' && !character.dead && gameState.resources.alcohol > 0,
                execute: (character) => {
                    // ìˆ  ì†Œëª¨ëŠ” ì„ íƒ ì‹œ ì²˜ë¦¬
                    character.preparingParty = true;
                    return "ì˜¤ëŠ˜ ë°¤ íŒŒí‹°ë¥¼ ì¤€ë¹„í–ˆì–´!";
                }
            },
            build: {
                name: 'ê±´ì„¤',
                description: 'ğŸ”§ë¶€í’ˆ 1ê°œë¥¼ ì†Œëª¨í•´ ë°©ì–´ì‹œì„¤ì„ ê±´ì„¤í•œë‹¤.',
                isAvailable: (character) => !character.dead && gameState.resources.parts > 0,
                execute: (character) => {
                    // ë¶€í’ˆ ì†Œëª¨ëŠ” ì„ íƒ ì‹œ ì²˜ë¦¬
                    gameState.defenseFortification += 2;
                    return `ê±´ì„¤ì„ í•´ì„œ ì•ìœ¼ë¡œ ê²½ê³„ë¥¼ ì„œë©´ ë°©ì–´ë„ê°€ ${gameState.defenseFortification}% ì˜¬ë¼ê°€ê²Œ ëì–´.`;
                }
            }
        };

        // DOM ìš”ì†Œ ì´ˆê¸°í™”
        function initializeDOM() {
            // ìºë¦­í„° ì¹´ë“œ ìƒì„±
            const charactersContainer = document.getElementById('characters-container');
            charactersContainer.innerHTML = '';
            
            gameState.characters.forEach(character => {
                const card = createCharacterCard(character);
                charactersContainer.appendChild(card);
            });
            
            // í„´ ì¢…ë£Œ ë²„íŠ¼ ì´ë²¤íŠ¸
            document.getElementById('end-turn-button').addEventListener('click', endTurn);
            
            // ê³„ì† ë²„íŠ¼ ì´ë²¤íŠ¸
            document.getElementById('continue-night-button').addEventListener('click', continueNightEvents);
            
            // ìì› íŒ¨ë„ ì—…ë°ì´íŠ¸
            updateResourcePanel();
            
            // íŠ¸ëŸ­ ë° ë°©ì–´ë„ ì—…ë°ì´íŠ¸
            updateGameStatus();
        }

        // ìºë¦­í„° ì¹´ë“œ ìƒì„±
        function createCharacterCard(character) {
            const card = document.createElement('div');
            card.className = `character-card ${character.dead ? 'dead' : ''}`;
            card.id = `character-${character.id}`;
            
            card.innerHTML = `
                <div class="character-name">
                    <span>${character.name}</span>
                    ${character.action ? `<span class="selected-action">(${actions[character.action].name})</span>` : ''}
                </div>
                <div class="character-trait">${character.trait}</div>
                <div class="status-labels" id="status-${character.id}">
                    ${character.injured ? '<span class="status-label injured">ë¶€ìƒ</span>' : ''}
                    ${character.depressed ? '<span class="status-label depressed">ìš°ìš¸</span>' : ''}
                    ${character.happy ? '<span class="status-label" style="background-color:var(--success-color);color:black;">í–‰ë³µ</span>' : ''}
                    ${character.dead ? '<span class="status-label dead">ì‚¬ë§</span>' : ''}
                </div>
                <div class="actions-container" id="actions-${character.id}">
                    <!-- í–‰ë™ ë²„íŠ¼ë“¤ì´ JavaScriptë¡œ ë™ì  ìƒì„±ë©ë‹ˆë‹¤ -->
                </div>
            `;
            
            // ìºë¦­í„°ê°€ ì£½ì—ˆìœ¼ë©´ í–‰ë™ ë¹„í™œì„±í™”
            if (!character.dead) {
                const actionsContainer = card.querySelector(`#actions-${character.id}`);
                
                // ê°€ëŠ¥í•œ í–‰ë™ë“¤ í‘œì‹œ
                Object.keys(actions).forEach(actionKey => {
                    const action = actions[actionKey];
                    
                    // í•´ë‹¹ ìºë¦­í„°ê°€ í•  ìˆ˜ ìˆëŠ” í–‰ë™ì¸ì§€ í™•ì¸
                    if (action.isAvailable(character)) {
                        const button = document.createElement('button');
                        button.className = 'action-button';
                        button.textContent = action.name;
                        button.disabled = character.action !== null;
                        
                        // íˆ´í¬ ì¶”ê°€
                        const tooltip = document.createElement('div');
                        tooltip.className = 'action-tooltip';
                        tooltip.textContent = action.description;
                        button.appendChild(tooltip);
                        
                        // í´ë¦­ ì´ë²¤íŠ¸
                        button.addEventListener('click', () => {
                            selectAction(character, actionKey);
                        });
                        
                        actionsContainer.appendChild(button);
                    }
                });
            }
            
            return card;
        }

        // í–‰ë™ ì„ íƒ
        function selectAction(character, actionKey) {
            character.action = actionKey;
            // íŒŒí‹° ì¤€ë¹„ë‚˜ ê±´ì„¤ì²˜ëŸ¼ ìì›ì„ ì†Œëª¨í•˜ëŠ” í–‰ë™ì€ ì„ íƒ ì¦‰ì‹œ ìì› ì°¨ê°
            if (actionKey === 'party') {
                if (gameState.resources.alcohol > 0) {
                    gameState.resources.alcohol -= 1;
                }
            }
            if (actionKey === 'build') {
                if (gameState.resources.parts > 0) {
                    gameState.resources.parts -= 1;
                }
            }
            // ë²„íŠ¼ ë¹„í™œì„±í™”
            const actionsContainer = document.querySelector(`#actions-${character.id}`);
            const buttons = actionsContainer.querySelectorAll('.action-button');
            buttons.forEach(button => {
                button.disabled = true;
            });
            // í„´ ì¢…ë£Œ ë²„íŠ¼ í™œì„±í™” ì—¬ë¶€ ì²´í¬
            checkEndTurnButton();
            // ìì› íŒ¨ë„ ì¦‰ì‹œ ê°±ì‹ 
            updateResourcePanel();
        }

        // í„´ ì¢…ë£Œ ë²„íŠ¼ í™œì„±í™” ì—¬ë¶€ ì²´í¬
        function checkEndTurnButton() {
            const endTurnButton = document.getElementById('end-turn-button');
            
            // ì‚´ì•„ìˆëŠ” ëª¨ë“  ìºë¦­í„°ê°€ í–‰ë™ì„ ì„ íƒí–ˆëŠ”ì§€ í™•ì¸
            const allSelected = gameState.characters.every(character => 
                character.dead || character.action !== null
            );
            
            endTurnButton.disabled = !allSelected;
        }

        // í„´ ì¢…ë£Œ
        function endTurn() {
            gameState.isNight = true;
            document.getElementById('time-period').textContent = 'ë°¤';
            
            // ë°¤ ì´ë²¤íŠ¸ ë©”ì‹œì§€ ì´ˆê¸°í™”
            gameState.nightMessages = [];
            gameState.currentMessageIndex = 0;
            
            // ê° ìºë¦­í„°ì˜ í–‰ë™ ê²°ê³¼ ì²˜ë¦¬
            gameState.characters.forEach(character => {
                if (!character.dead && character.action !== null) {
                    const action = actions[character.action];
                    const result = action.execute(character);
                    gameState.nightMessages.push(`${character.name}: ${result}`);
                }
                
                // í–‰ë™ ì´ˆê¸°í™”
                character.action = null;
            });
            
            // ì‹ëŸ‰ ì†Œë¹„
            consumeFood();
            
            // ë°©ì–´ë„ í•˜ë½
            gameState.defense -= (gameState.day >= 14 ? 10 : 5);
            if (gameState.defense < 0) gameState.defense = 0;
            
            // ë°¤ ì´ë²¤íŠ¸ ì²´í¬
            checkNightEvents();
            
            // ë‹¤ìŒ í„´ ì¤€ë¹„
            updateResourcePanel();
            updateGameStatus();
            
            // ë©”ì‹œì§€ ë¡œê·¸ì— ë‚ ì§œ ì¶”ê°€
            addToMessageLog(`===== ${gameState.day}ì¼ì°¨ ë°¤ =====`);
            
            // ë°¤ ì´ë²¤íŠ¸ ëª¨ë‹¬ ì‹œì‘
            startNightEvents();
        }

        // ì‹ëŸ‰ ì†Œë¹„
        function consumeFood() {
            // ìºë¦­í„° ìˆœì„œ: ì •ìœ¤ì§€ - ì‹ ì„œí˜„ - ì°¨í•„ê·¼ - ì˜¤ì„±êµ­
            const order = ['yoonji', 'seohyun', 'pilgeun', 'sungkook'];
            
            for (const id of order) {
                const character = gameState.characters.find(c => c.id === id);
                
                if (!character.dead) {
                    // ì˜¤ì„±êµ­ì€ ì‹ëŸ‰ 2ê°œ ì†Œë¹„
                    const neededFood = character.id === 'sungkook' ? 2 : 1;
                    
                    if (character.id === 'yoonji') {
                        // ìœ¤ì§€ëŠ” ì•¼ì±„ë§Œ ë¨¹ìŒ
                        if (gameState.resources.vegetables >= neededFood) {
                            gameState.resources.vegetables -= neededFood;
                        } else {
                            // ì‹ëŸ‰ ë¶€ì¡±
                            gameState.nightMessages.push(`${character.name}: ì•¼ì±„ ì•„ë‹ˆë©´ ì•ˆ ë¨¹ì„ë˜...`);
                            makeDepressed(character);
                        }
                    } else {
                        // ë‹¤ë¥¸ ìºë¦­í„°ë“¤ì€ ê³ ê¸° ìš°ì„ , ë¶€ì¡±í•˜ë©´ ì•¼ì±„
                        if (gameState.resources.meat >= neededFood) {
                            gameState.resources.meat -= neededFood;
                        } else if (gameState.resources.vegetables >= neededFood) {
                            gameState.resources.vegetables -= neededFood;
                        } else if (gameState.resources.meat + gameState.resources.vegetables >= neededFood) {
                            // í˜¼í•© ì‹ëŸ‰
                            const usedMeat = Math.min(gameState.resources.meat, neededFood);
                            gameState.resources.meat -= usedMeat;
                            gameState.resources.vegetables -= (neededFood - usedMeat);
                        } else {
                            // ì‹ëŸ‰ ë¶€ì¡±
                            gameState.nightMessages.push(`${character.name}: ì‹ëŸ‰ì´ ë¶€ì¡±í•´ì„œ êµ¶ì—ˆì–´...`);
                            makeDepressed(character);
                        }
                    }
                }
            }
        }

        // ìºë¦­í„° ìƒíƒœ ë³€ê²½ í•¨ìˆ˜ë“¤
        function setDepressed(character, value) {
            if (value === true) {
                // ìš°ìš¸í•´ì§ˆ ë•Œ í–‰ë³µ ìƒíƒœë¥¼ ë¨¼ì € ì œê±°
                character.happy = false;
            }
            character.depressed = value;
        }
        
        function setHappy(character, value) {
            if (value === true) {
                // í–‰ë³µí•´ì§ˆ ë•Œ ìš°ìš¸ ìƒíƒœë¥¼ ë¨¼ì € ì œê±°
                character.depressed = false;
            }
            character.happy = value;
        }
        
        function setInjured(character, value) {
            character.injured = value;
        }

        // ìºë¦­í„° ìš°ìš¸í•˜ê²Œ ë§Œë“¦
        function makeDepressed(character) {
            if (character.happy) {
                setHappy(character, false);
                gameState.nightMessages.push(`${character.name}: ${character.name} ì´ì œ ì•ˆ í–‰ë³µí•´...`);
                return;
            }
            if (Math.random() < 0.5) {
                if (!character.depressed) {
                    setDepressed(character, true);
                    gameState.nightMessages.push(`${character.name}: ìš°ìš¸í•´ì¡Œì–´...`);
                } else {
                    character.dead = true;
                    gameState.nightMessages.push(`${character.name}: ë¯¸ì•ˆ, ì¹œêµ¬ë“¤. ë‚˜ ê°™ì€ ì“°ë ˆê¸°ê°€ ì‚´ì•„ì„œ ë­í•˜ê² ì–´. ì˜ ìˆì–´.`);
                    handleCharacterDeath();
                }
            }
        }

        // ìºë¦­í„° ë¶€ìƒ ì…í˜
        function makeInjured(character) {
            if (character.happy) {
                setHappy(character, false);
                gameState.nightMessages.push(`${character.name}: í–‰ë³µì´ ì‚¬ë¼ì¡Œì–´...`);
            }
            if (!character.injured) {
                setInjured(character, true);
                gameState.nightMessages.push(`${character.name}: ë¶€ìƒì„ ì…ì—ˆì–´...`);
            } else {
                character.dead = true;
                gameState.nightMessages.push(`${character.name}: ì»¤í—‰! (í”¼ í† í•˜ëŠ” ì†Œë¦¬)`);
                handleCharacterDeath();
            }
        }

        // ìºë¦­í„° ì‚¬ë§ ì²˜ë¦¬
        function handleCharacterDeath() {
            // ë‹¤ë¥¸ ìºë¦­í„°ë“¤ 50% í™•ë¥ ë¡œ ìš°ìš¸
            gameState.characters.forEach(character => {
                if (!character.dead && Math.random() < 0.5) {
                    if (!character.depressed) {
                        setDepressed(character, true);
                        // ê°€ì¥ ìµœê·¼ì— ì£½ì€ ìºë¦­í„° ì°¾ê¸°
                        const recentlyDeadCharacters = gameState.characters.filter(c => c.dead && !c.wasProcessed);
                        if (recentlyDeadCharacters.length > 0) {
                            // ê°€ì¥ ìµœê·¼ì— ì£½ì€ ìºë¦­í„° ì„ íƒ
                            const deadCharacter = recentlyDeadCharacters[recentlyDeadCharacters.length - 1];
                            deadCharacter.wasProcessed = true; // ì´ë¯¸ ì–¸ê¸‰ëœ ìºë¦­í„° í‘œì‹œ
                            gameState.nightMessages.push(`${character.name}: ${deadCharacter.name}ì´ê°€ ì£½ë‹¤ë‹ˆ...`);
                        } else {
                            // ì£½ì€ ìºë¦­í„°ë¥¼ íŠ¹ì •í•  ìˆ˜ ì—†ëŠ” ê²½ìš° ê¸°ë³¸ ë©”ì‹œì§€
                            gameState.nightMessages.push(`${character.name}: ë„ˆë¬´ ìŠ¬í¼...`);
                        }
                    }
                }
            });
            
            // ê²Œì„ ì˜¤ë²„ ì²´í¬
            checkGameOver();
        }

        // ë°¤ ì´ë²¤íŠ¸ ì²´í¬
        function checkNightEvents() {
            // ìŠµê²© ì²´í¬ (ë°©ì–´ë„ì˜ í™•ë¥ ë¡œ ìŠµê²© ì—†ìŒ)
            if (Math.random() > gameState.defense / 100) {
                // ìŠµê²© ë°œìƒ
                gameState.nightMessages.push("ê°±ë‹¨ì´ ìŠµê²©í•´ì™”ë‹¤!");
                
                // ì„±êµ­ì´ ì‚´ì•„ìˆê³  ë¶€ìƒì´ ì•„ë‹ˆë¼ë©´ 25% í™•ë¥ ë¡œ ê²©í‡´
                const sungkook = gameState.characters.find(c => c.id === 'sungkook');
                if (sungkook && !sungkook.dead && !sungkook.injured && Math.random() < 0.25) {
                    gameState.nightMessages.push("ì˜¤ì„±êµ­: ê±±ì • ë§ˆ! ë‚´ê°€ ê²©í‡´í–ˆì–´!");
                    // ê²©í‡´ ì„±ê³µ ì‹œ ë¶€ìƒì ì—†ìŒ
                } else {
                    // íŒŒí‹°ê°€ ì¤€ë¹„ë˜ì–´ ìˆì—ˆë‹¤ë©´ ì·¨ì†Œ
                    const pilgeun = gameState.characters.find(c => c.id === 'pilgeun');
                    if (pilgeun?.preparingParty) {
                        gameState.nightMessages.push("íŒŒí‹°ëŠ” ì·¨ì†Œëë‹¤!");
                        pilgeun.preparingParty = false;
                    }
                    
                    // ì‚´ì•„ìˆëŠ” ì‚¬ëŒ ì¤‘ í•œ ëª… ë¶€ìƒ
                    const livingCharacters = gameState.characters.filter(c => !c.dead);
                    if (livingCharacters.length > 0) {
                        const victimIndex = Math.floor(Math.random() * livingCharacters.length);
                        const victim = livingCharacters[victimIndex];
                        makeInjured(victim);
                    }
                       // ë°©ì–´ë„ê°€ ë‚®ì„ìˆ˜ë¡ íŠ¸ëŸ­ ê³µê²© í™•ë¥  ì¦ê°€ (ë°©ì–´ë„ 30% ì´í•˜ë©´ 70% í™•ë¥ ë¡œ íŠ¸ëŸ­ ê³µê²©)
                       if (Math.random() > gameState.defense / 100) {
                        const damage = Math.floor(Math.random() * 10) + 1; // 1-10 ë°ë¯¸ì§€
                        gameState.truckDurability -= damage;
                        
                        // ëœë¤ ìƒì¡´ìê°€ íŠ¸ëŸ­ ê³µê²© ìƒí™© ë³´ê³ 
                        const livingChars = gameState.characters.filter(c => !c.dead);
                        if (livingChars.length > 0) {
                            const reporter = livingChars[Math.floor(Math.random() * livingChars.length)];
                            gameState.nightMessages.push(`${reporter.name}: ë†ˆë“¤ì´ íŠ¸ëŸ­ê¹Œì§€ ê³µê²©í–ˆì–´!`);
                        }
                    }
                }
            } else if (gameState.characters.find(c => c.id === 'pilgeun')?.preparingParty) {
                // íŒŒí‹° ì¤€ë¹„í–ˆê³  ìŠµê²©ì´ ì—†ì—ˆìŒ
                gameState.nightMessages.push("ì°¨í•„ê·¼ì´ ì¤€ë¹„í–ˆë‹¤ëŠ” íŒŒí‹°ê°€ ì‹œì‘ëë‹¤!");
                
                // ëœë¤í•˜ê²Œ 3ê°œì˜ ëŒ€ì‚¬ ì¤‘ í•˜ë‚˜ ì„ íƒ
                const partyMessages = [
                    "ì°¨í•„ê·¼: ë‹¤ê°™ì´ ìš°ë¦¬ ë°˜ì§€í•˜ì˜ ë¯¸ë˜ë¥¼ ìŠ¤ì¼€ì¹˜ë¶ì— ê·¸ë ¤ë³¼ê¹Œìš”?",
                    "ì°¨í•„ê·¼: ì œê°€ í”¼ì•„ë…¸ë¥¼ ì—°ì£¼í•´ë“œë¦´ê²Œìš”! (ë”©ë”©ë”©)",
                    "ì°¨í•„ê·¼: (ì—´ì°½í•˜ë©°) ì••ë‘˜ë°”~ ì••ë‘˜ë°”~ ì••ë‘˜ë°”~"
                ];
                const randomMessage = partyMessages[Math.floor(Math.random() * partyMessages.length)];
                gameState.nightMessages.push(randomMessage);
                
                // ëª¨ë“  ìºë¦­í„°ì˜ ìš°ìš¸ íšŒë³µ
                gameState.characters.forEach(character => {
                    if (!character.dead && character.depressed) {
                        setDepressed(character, false);
                        gameState.nightMessages.push(`${character.name}: ìš°ìš¸í•¨ì´ ì‚¬ë¼ì¡Œì–´!`);
                    }
                });
                // íŒŒí‹° ì„±ê³µ ì‹œ ëœë¤ ìƒì¡´ì 1ëª…ì—ê²Œ í–‰ë³µ ë¶€ì—¬
                const living = gameState.characters.filter(c => !c.dead);
                if (living.length > 0) {
                    const lucky = living[Math.floor(Math.random() * living.length)];
                    setHappy(lucky, true);
                    gameState.nightMessages.push(`${lucky.name}: ${lucky.name} í–‰ë³µí•´! ë­ë“ ì§€ í•´ë‚¼ ìˆ˜ ìˆì„ ê²ƒë§Œ ê°™ì•„!`);
                }
            }
            
            // íŒŒí‹° ì¤€ë¹„ ìƒíƒœ ì´ˆê¸°í™”
            const pilgeun = gameState.characters.find(c => c.id === 'pilgeun');
            if (pilgeun) {
                pilgeun.preparingParty = false;
            }
        }

        // ë°¤ ì´ë²¤íŠ¸ ì‹œì‘
        function startNightEvents() {
            if (gameState.nightMessages.length > 0) {
                const modal = document.getElementById('night-events-modal');
                const message = document.getElementById('night-event-message');
                message.textContent = gameState.nightMessages[gameState.currentMessageIndex];
                modal.style.display = 'flex';
            } else {
                goToNextDay();
            }
        }

        // ë°¤ ì´ë²¤íŠ¸ ê³„ì†
        function continueNightEvents() {
            gameState.currentMessageIndex++;
            
            if (gameState.currentMessageIndex < gameState.nightMessages.length) {
                const message = document.getElementById('night-event-message');
                message.textContent = gameState.nightMessages[gameState.currentMessageIndex];
            } else {
                const modal = document.getElementById('night-events-modal');
                modal.style.display = 'none';
                goToNextDay();
            }
        }

        // ë‹¤ìŒ ë‚ ë¡œ
        function goToNextDay() {
            gameState.day++;
            gameState.isNight = false;
            document.getElementById('time-period').textContent = 'ë‚®';
            
            // ë©”ì‹œì§€ ë¡œê·¸ì— ë‚ ì§œ ì¶”ê°€
            addToMessageLog(`===== ${gameState.day}ì¼ì°¨ ë‚® =====`);
            
            // ì‹ëŸ‰ ë¶€ì¡± ì²´í¬
            const totalMeat = gameState.resources.meat;
            const totalVegetables = gameState.resources.vegetables;
            
            // í•„ìš”í•œ ì‹ëŸ‰ ê³„ì‚° (ê¸°ë³¸ì ìœ¼ë¡œ ìƒì¡´ì 1ëª…ë‹¹ 1ê°œì”©)
            let requiredFood = 0;
            gameState.characters.forEach(character => {
                if (!character.dead) {
                    // ì˜¤ì„±êµ­ì€ ì‹ëŸ‰ì„ 2ê°œ ì†Œë¹„
                    requiredFood += (character.id === 'sungkook') ? 2 : 1;
                }
            });
            
            // ì‹ëŸ‰ ë¶€ì¡± ê²½ê³ 
            if (totalMeat + totalVegetables < requiredFood) {
                // ì‚´ì•„ìˆëŠ” ìºë¦­í„° ì¤‘ ëœë¤ìœ¼ë¡œ í•œ ëª… ì„ íƒ
                const livingCharacters = gameState.characters.filter(c => !c.dead);
                if (livingCharacters.length > 0) {
                    const randomIndex = Math.floor(Math.random() * livingCharacters.length);
                    const warningCharacter = livingCharacters[randomIndex];
                    addToMessageLog(`${warningCharacter.name}: ì‹ëŸ‰ì´ ë¶€ì¡±í•´. ì´ëŸ¬ë‹¤ êµ¶ê² ì–´.`);
                }
            }
            
            // ìºë¦­í„° ì—…ë°ì´íŠ¸
            gameState.characters.forEach(character => {
                const card = document.getElementById(`character-${character.id}`);
                if (character.dead) {
                    card.classList.add('dead');
                } else {
                    // ìƒíƒœ ë¼ë²¨ ì—…ë°ì´íŠ¸
                    const statusContainer = document.getElementById(`status-${character.id}`);
                    statusContainer.innerHTML = '';
                    if (character.injured) {
                        const label = document.createElement('span');
                        label.className = 'status-label injured';
                        label.textContent = 'ë¶€ìƒ';
                        statusContainer.appendChild(label);
                    }
                    if (character.depressed) {
                        const label = document.createElement('span');
                        label.className = 'status-label depressed';
                        label.textContent = 'ìš°ìš¸';
                        statusContainer.appendChild(label);
                    }
                    if (character.happy) {
                        const label = document.createElement('span');
                        label.className = 'status-label';
                        label.style.backgroundColor = 'var(--success-color)';
                        label.style.color = 'black';
                        label.textContent = 'í–‰ë³µ';
                        statusContainer.appendChild(label);
                    }
                }
            });
            
            // í–‰ë™ ë²„íŠ¼ ì´ˆê¸°í™”
            initializeDOM();
            
            // ê²Œì„ í´ë¦¬ì–´ ì²´í¬
            if (gameState.truckDurability >= 100) {
                endGame(true);
            }
        }

        // ê²Œì„ ì˜¤ë²„ ì²´í¬
        function checkGameOver() {
            const allDead = gameState.characters.every(character => character.dead);
            if (allDead) {
                endGame(false);
            }
        }

        // ê²Œì„ ì¢…ë£Œ
        function endGame(victory) {
            const modal = document.getElementById('game-over-modal');
            const title = document.getElementById('modal-title');
            const message = document.getElementById('modal-message');
            
            if (victory) {
                title.textContent = 'íƒˆì¶œ!';
                
                // ìƒì¡´ì ìˆ˜ í™•ì¸ ë° ë­í¬ ë¶€ì—¬
                const survivors = gameState.characters.filter(character => !character.dead);
                const survivorNames = survivors.map(character => character.name).join(', ');
                let rank = '';
                
                if (survivors.length === 4) {
                    rank = 'S';
                } else if (survivors.length === 3) {
                    rank = 'A';
                } else if (survivors.length === 2) {
                    rank = 'B';
                } else if (survivors.length === 1) {
                    rank = 'C';
                }
                
                message.textContent = `${gameState.day}ì¼ ë§Œì— ìœ„í—˜ ì§€ì—­ì„ íƒˆì¶œí–ˆìŠµë‹ˆë‹¤. 
ìƒì¡´ì: ${survivorNames} (${rank}ë­í¬)`;
            } else {
                title.textContent = 'íŒ¨ë°°...';
                message.textContent = 'ëª¨ë“  ìƒì¡´ìê°€ ì£½ì—ˆìŠµë‹ˆë‹¤...';
            }
            
            modal.style.display = 'flex';
        }

        // ê²Œì„ ì¬ì‹œì‘
        function restartGame() {
            location.reload();
        }

        // ìì› íŒ¨ë„ ì—…ë°ì´íŠ¸
        function updateResourcePanel() {
            document.getElementById('meat-value').textContent = gameState.resources.meat;
            document.getElementById('vegetables-value').textContent = gameState.resources.vegetables;
            document.getElementById('parts-value').textContent = gameState.resources.parts;
            document.getElementById('alcohol-value').textContent = gameState.resources.alcohol;
        }

        // ê²Œì„ ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateGameStatus() {
            document.getElementById('day-value').textContent = gameState.day;
            document.getElementById('truck-value').textContent = `${gameState.truckDurability}%`;
            document.getElementById('defense-value').textContent = `${gameState.defense}%`;
            
            document.getElementById('truck-bar').style.width = `${gameState.truckDurability}%`;
            document.getElementById('defense-bar').style.width = `${gameState.defense}%`;
        }

        // ë©”ì‹œì§€ ë¡œê·¸ì— ì¶”ê°€
        function addToMessageLog(message) {
            const messageLog = document.getElementById('message-log');
            const messageElement = document.createElement('div');
            messageElement.className = 'message';
            messageElement.textContent = message;
            messageLog.appendChild(messageElement);
            messageLog.scrollTop = messageLog.scrollHeight;
        }

        // ê²Œì„ ì´ˆê¸°í™” ë° ì‹œì‘
        window.onload = function() {
            initializeDOM();
        };
    </script>
</body>
</html>