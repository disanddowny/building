<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Î∞òÏßÄÌïò 2033 Í¥ëÍ∏∞Ïùò Ìä∏Îü≠</title>
    <style>
        :root {
            --primary-color: #3a3a3c;
            --secondary-color: #2c2c2e;
            --accent-color: #ff9500;
            --text-color: #f5f5f7;
            --border-color: #515154;
            --danger-color: #ff3b30;
            --success-color: #34c759;
            --warning-color: #ffcc00;
            --info-color: #5ac8fa;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: var(--primary-color);
            color: var(--text-color);
            padding: 20px;
            max-width: 1000px;
            margin: 0 auto;
        }
        
        .game-container {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
        }
        
        .resources-panel {
            background-color: var(--secondary-color);
            border-radius: 8px;
            padding: 15px;
            border: 1px solid var(--border-color);
            margin-bottom: 20px;
        }
        
        .resource-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }
        
        .resource-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(0,0,0,0.2);
            padding: 8px 12px;
            border-radius: 4px;
        }
        
        .resource-icon {
            width: 24px;
            height: 24px;
            margin-right: 8px;
            display: inline-block;
            text-align: center;
        }
        
        .resource-value {
            font-weight: bold;
            color: var(--accent-color);
        }
        
        h1, h2, h3 {
            margin-bottom: 15px;
            color: var(--accent-color);
        }
        
        .characters-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .character-card {
            background-color: var(--secondary-color);
            border-radius: 8px;
            padding: 15px;
            border: 1px solid var(--border-color);
            position: relative;
        }
        
        .character-card.dead {
            opacity: 0.6;
            background-color: #222;
        }
        
        .character-name {
            font-size: 1.2em;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .selected-action {
            font-size: 0.8em;
            color: var(--accent-color);
            margin-left: 8px;
        }
        
        .character-trait {
            font-size: 0.9em;
            margin-bottom: 10px;
            font-style: italic;
            color: #aaa;
        }
        
        .status-labels {
            display: flex;
            gap: 5px;
            margin-bottom: 10px;
        }
        
        .status-label {
            font-size: 0.8em;
            padding: 3px 8px;
            border-radius: 4px;
            background-color: var(--danger-color);
        }
        
        .status-label.depressed {
            background-color: var(--warning-color);
            color: black;
        }
        
        .status-label.injured {
            background-color: var(--danger-color);
        }
        
        .status-label.dead {
            background-color: black;
        }
        
        .actions-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }
        
        .action-button {
            padding: 8px;
            border: none;
            border-radius: 4px;
            background-color: #515154;
            color: white;
            cursor: pointer;
            transition: background-color 0.2s;
            position: relative;
        }
        
        .action-button:hover {
            background-color: #6d6d70;
        }
        
        .action-button:disabled {
            background-color: #3a3a3c;
            color: #8e8e93;
            cursor: not-allowed;
        }
        
        .action-tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0,0,0,0.9);
            padding: 8px 12px;
            border-radius: 4px;
            width: 200px;
            z-index: 100;
            display: none;
            font-size: 0.85em;
            line-height: 1.4;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }
        
        .action-button:hover .action-tooltip {
            display: block;
        }
        
        .game-panel {
            background-color: var(--secondary-color);
            border-radius: 8px;
            padding: 15px;
            border: 1px solid var(--border-color);
        }
        
        .end-turn-container {
            margin-top: 20px;
            text-align: center;
        }
        
        .end-turn-button {
            padding: 12px 24px;
            background-color: var(--accent-color);
            color: black;
            border: none;
            border-radius: 4px;
            font-weight: bold;
            cursor: pointer;
            font-size: 1.1em;
        }
        
        .end-turn-button:disabled {
            background-color: #8e8e93;
            cursor: not-allowed;
        }
        
        .message-log {
            background-color: rgba(0,0,0,0.2);
            border-radius: 8px;
            padding: 15px;
            height: 200px;
            overflow-y: auto;
            margin-top: 20px;
            border: 1px solid var(--border-color);
        }
        
        .message {
            margin-bottom: 10px;
            line-height: 1.4;
            padding-left: 10px;
            border-left: 3px solid var(--border-color);
        }
        
        .continue-button {
            margin-top: 10px;
            padding: 8px 16px;
            background-color: var(--accent-color);
            color: black;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .game-status {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
        }
        
        .game-status-item {
            font-weight: bold;
        }
        
        .progress-container {
            height: 20px;
            background-color: rgba(0,0,0,0.2);
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 15px;
        }
        
        .progress-bar {
            height: 100%;
            background-color: var(--success-color);
            transition: width 0.3s ease;
        }
        
        .progress-bar.defense {
            background-color: var(--info-color);
        }
        
        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .modal-content {
            background-color: var(--primary-color);
            padding: 20px;
            border-radius: 8px;
            max-width: 500px;
            text-align: center;
        }
        
        .modal-title {
            font-size: 1.5em;
            margin-bottom: 15px;
        }
        
        .modal-button {
            padding: 10px 20px;
            margin-top: 20px;
            background-color: var(--accent-color);
            color: black;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>Î∞òÏßÄÌïò 2033 Í¥ëÍ∏∞Ïùò Ìä∏Îü≠</h1>
    
    <div class="game-container">
        <div class="left-panel">
            <div class="resources-panel">
                <h2>ÏûêÏõê</h2>
                <div class="resource-grid">
                    <div class="resource-item">
                        <div><span class="resource-icon">ü•©</span> Í≥†Í∏∞</div>
                        <div class="resource-value" id="meat-value">3</div>
                    </div>
                    <div class="resource-item">
                        <div><span class="resource-icon">ü•ï</span> ÏïºÏ±Ñ</div>
                        <div class="resource-value" id="vegetables-value">3</div>
                    </div>
                    <div class="resource-item">
                        <div><span class="resource-icon">üîß</span> Î∂ÄÌíà</div>
                        <div class="resource-value" id="parts-value">0</div>
                    </div>
                    <div class="resource-item">
                        <div><span class="resource-icon">üç∫</span> Ïà†</div>
                        <div class="resource-value" id="alcohol-value">0</div>
                    </div>
                </div>
            </div>
            
            <div class="game-panel">
                <div class="game-status">
                    <div class="game-status-item">ÎÇ†Ïßú: <span id="day-value">1</span>ÏùºÏ∞® <span id="time-period">ÎÇÆ</span></div>
                </div>
                
                <div class="progress-label">
                    <span>Ìä∏Îü≠ ÎÇ¥Íµ¨ÎèÑ</span>
                    <span id="truck-value">0%</span>
                </div>
                <div class="progress-container">
                    <div class="progress-bar" id="truck-bar" style="width: 0%;"></div>
                </div>
                
                <div class="progress-label">
                    <span>Ï∫†ÌîÑ Î∞©Ïñ¥ÎèÑ</span>
                    <span id="defense-value">100%</span>
                </div>
                <div class="progress-container">
                    <div class="progress-bar defense" id="defense-bar" style="width: 100%;"></div>
                </div>
                
                <div class="end-turn-container">
                    <button id="end-turn-button" class="end-turn-button">ÌÑ¥ Ï¢ÖÎ£å</button>
                </div>
            </div>
            
            <div class="message-log" id="message-log">
                <div class="message">Ìä∏Îü≠ÏùÑ ÌÉÄÍ≥† ÌèêÌóà ÏÑúÏö∏ÏùÑ Ïã†ÎÇòÍ≤å ÎàÑÎπÑÎçò Î∞òÏßÄÌïò Ìå®Í±∞Î¶¨! Í∑∏Îü¨ÎÇò Í∞ëÏûêÍ∏∞ Ìä∏Îü≠Ïù¥ Í≥†Ïû•ÎÇòÎ©∞ Ïô∏Îî¥ Í≥≥Ïóê Î©àÏ∂îÍ≥† ÎßêÏïòÏäµÎãàÎã§. ÏúÑÌóòÌïú ÏÑ∏Î†•Ïù¥ ÎçÆÏπòÍ∏∞ Ï†ÑÏóê Ìä∏Îü≠ÏùÑ ÏàòÎ¶¨ÌïòÍ≥† Îñ†ÎÇòÏïº Ìï©ÎãàÎã§.</div>
            </div>
        </div>
        
        <div class="characters-container" id="characters-container">
            <!-- Ï∫êÎ¶≠ÌÑ∞ Ïπ¥ÎìúÎì§Ïù¥ JavaScriptÎ°ú ÎèôÏ†Å ÏÉùÏÑ±Îê©ÎãàÎã§ -->
        </div>
    </div>
    
    <div id="game-over-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <h2 class="modal-title" id="modal-title">Í≤åÏûÑ Ï¢ÖÎ£å</h2>
            <p id="modal-message">Î™®Îì† ÏÉùÏ°¥ÏûêÍ∞Ä Ï£ΩÏóàÏäµÎãàÎã§.</p>
            <button class="modal-button" onclick="restartGame()">Îã§Ïãú ÏãúÏûë</button>
        </div>
    </div>
    
    <div id="night-events-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <h2 class="modal-title">Î∞§ Ïù¥Î≤§Ìä∏</h2>
            <p id="night-event-message"></p>
            <button class="modal-button" id="continue-night-button">Í≥ÑÏÜç</button>
        </div>
    </div>
    
    <script>
        // Í≤åÏûÑ ÏÉÅÌÉú
        const gameState = {
            day: 1,
            isNight: false,
            truckDurability: 0,
            defenseFortification: 5, // Í∏∞Î≥∏ Î∞©Ïñ¥ÎèÑ Ï¶ùÍ∞ÄÎüâ
            defense: 100,
            resources: {
                meat: 3,
                vegetables: 3,
                parts: 0,
                alcohol: 0
            },
            characters: [
                {
                    id: 'yoonji',
                    name: 'Ï†ïÏú§ÏßÄ',
                    trait: 'Í≥†Í∏∞Îäî Î™ª Î®πÍ≥† ÏïºÏ±ÑÎßå Î®πÏùÑ Ïàò ÏûàÎã§',
                    action: null,
                    injured: false,
                    depressed: false,
                    dead: false,
                    happy: false
                },
                {
                    id: 'seohyun',
                    name: 'Ïã†ÏÑúÌòÑ',
                    trait: 'ÏàòÎ¶¨ Ìö®Í≥ºÍ∞Ä 2Î∞∞Í∞Ä ÎêúÎã§',
                    action: null,
                    injured: false,
                    depressed: false,
                    dead: false,
                    happy: false
                },
                {
                    id: 'pilgeun',
                    name: 'Ï∞®ÌïÑÍ∑º',
                    trait: 'ÌååÌã∞ Ï§ÄÎπÑÎ•º Ìï† Ïàò ÏûàÎã§',
                    action: null,
                    injured: false,
                    depressed: false,
                    dead: false,
                    preparingParty: false,
                    happy: false
                },
                {
                    id: 'sungkook',
                    name: 'Ïò§ÏÑ±Íµ≠',
                    trait: 'ÌïòÎ£®Ïóê ÏãùÎüâ 2Í∞úÎ•º ÏÜåÎπÑÌïúÎã§',
                    action: null,
                    injured: false,
                    depressed: false,
                    dead: false,
                    happy: false
                }
            ],
            nightMessages: [],
            currentMessageIndex: 0
        };

        // ÌñâÎèô Ï†ïÏùò
        const actions = {
            repair: {
                name: 'Ìä∏Îü≠ ÏàòÎ¶¨',
                description: 'Ìä∏Îü≠ ÎÇ¥Íµ¨ÎèÑÎ•º Ï¶ùÍ∞ÄÏãúÌÇ®Îã§. üîßÎ∂ÄÌíàÏùÑ Ïì∏ Ïàò ÏûàÎã§.',
                isAvailable: (character) => !character.dead,
                execute: (character) => {
                    let prefix = '';
                    let bonus = 0;
                    if (character.happy) {
                        prefix = '(Ïã±Í∏ÄÎ≤ôÍ∏Ä) ';
                        bonus = 1;
                    }
                    let repairAmount = 1 + bonus;
                    // Î∂ÄÌíàÎãπ Ï∂îÍ∞Ä ÏàòÎ¶¨
                  
                    // ÏÑúÌòÑÏùÄ ÏàòÎ¶¨ Ìö®Í≥º 2Î∞∞ (Í∏∞Î≥∏ ÏàòÎ¶¨ÎüâÍ≥º Î∂ÄÌíà Ìö®Í≥º Î™®Îëê Ìè¨Ìï®)
                    if (character.id === 'seohyun') {
                        repairAmount *= 2;
                    }  
                    let partMessage = '';
                    if (gameState.resources.parts > 0) {
                        repairAmount += gameState.resources.parts;
                        gameState.resources.parts -= 1;
                        partMessage = 'Î∂ÄÌíàÏúºÎ°ú ';
                    }
                    gameState.truckDurability += repairAmount;
                    return `${prefix}${partMessage}Ìä∏Îü≠ÏùÑ ÏàòÎ¶¨Ìï¥ÏÑú ÎÇ¥Íµ¨ÎèÑÎ•º ${repairAmount}% Ï¶ùÍ∞ÄÏãúÏº∞Ïñ¥.`;
                }
            },
            forest: {
                name: 'Ïà≤ Î≥¥ÎÇ¥Í∏∞',
                description: 'Ïà≤ÏóêÏÑú ÏãùÎüâÏùÑ Ï∞æÏïÑÎ≥∏Îã§.',
                isAvailable: (character) => !character.dead && !character.injured,
                execute: (character) => {
                    let prefix = '';
                    if (character.happy) prefix = '(Ïã±Í∏ÄÎ≤ôÍ∏Ä) ';
                    // Ïú§ÏßÄÎäî ÏïºÏ±ÑÎßå 0-5Í∞ú Í∞ÄÏ†∏Ïò¥
                    if (character.id === 'yoonji') {
                        let min = character.happy ? 1 : 0;
                        const vegetablesFound = Math.floor(Math.random() * (6 - min)) + min; // min~5
                        gameState.resources.vegetables += vegetablesFound;
                        return `${prefix}Ïà≤Ïóê Í∞ÄÏÑú ÏïºÏ±Ñ ${vegetablesFound}Í∞úÎ•º Í∞ÄÏ†∏ÏôîÏñ¥.`;
                    } else {
                        let min = character.happy ? 1 : 0;
                        const meatFound = Math.floor(Math.random() * (3 - min)) + min; // min~2
                        const vegetablesFound = Math.floor(Math.random() * (3 - min)) + min; // min~2
                        gameState.resources.meat += meatFound;
                        gameState.resources.vegetables += vegetablesFound;
                        return `${prefix}Ïà≤Ïóê Í∞ÄÏÑú Í≥†Í∏∞ ${meatFound}Í∞ú, ÏïºÏ±Ñ ${vegetablesFound}Í∞úÎ•º Í∞ÄÏ†∏ÏôîÏñ¥.`;
                    }
                }
            },
            ruins: {
                name: 'ÌèêÌóà Î≥¥ÎÇ¥Í∏∞',
                description: 'ÌéòÌóàÏóêÏÑú Ïì∏ÎßåÌïú Í±∏ Ï∞æÏïÑÎ≥∏Îã§.',
                isAvailable: (character) => !character.dead && !character.injured,
                execute: (character) => {
                    let prefix = '';
                    if (character.happy) prefix = '(Ïã±Í∏ÄÎ≤ôÍ∏Ä) ';
                    let min = character.happy ? 1 : 0;
                    const partsFound = Math.floor(Math.random() * (2 - min)) + min; // min~1
                    const alcoholFound = Math.floor(Math.random() * (2 - min)) + min; // min~1
                    gameState.resources.parts += partsFound;
                    gameState.resources.alcohol += alcoholFound;
                    let message = `${prefix}ÌèêÌóàÏóê Í∞ÄÏÑú Î∂ÄÌíà ${partsFound}Í∞ú, Ïà† ${alcoholFound}Í∞úÎ•º Í∞ÄÏ†∏ÏôîÏñ¥.`;
                    // 50% ÌôïÎ•†Î°ú Î∂ÄÏÉÅ
                    if (Math.random() < 0.5) {
                        character.injured = true;
                        message += " ÌïòÏßÄÎßå Î∂ÄÏÉÅÏùÑ ÏûÖÏóàÏñ¥.";
                    }
                    return message;
                }
            },
            blackmarket: {
                name: 'ÏïîÏãúÏû• Î≥¥ÎÇ¥Í∏∞',
                description: 'üç∫Ïà† 1Í∞úÎ•º ÏÜåÎ™®Ìï¥ ü•©Í≥†Í∏∞Î•º Íµ¨ÌïúÎã§.',
                isAvailable: (character) => !character.dead && !character.injured && gameState.resources.alcohol > 0,
                execute: (character) => {
                    let prefix = '';
                    if (character.happy) prefix = '(Ïã±Í∏ÄÎ≤ôÍ∏Ä) ';
                    gameState.resources.alcohol -= 1;
                    let min = character.happy ? 3 : 2;
                    const meatFound = Math.floor(Math.random() * (6 - min + 1)) + min; // min~6
                    gameState.resources.meat += meatFound;
                    let message = `${prefix}ÏïîÏãúÏû•Ïóê Í∞ÄÏÑú Ïà† 1Í∞úÎ•º Í≥†Í∏∞ ${meatFound}Í∞úÎ°ú Î∞îÍøîÏôîÏñ¥.`;
                    // 50% ÌôïÎ•†Î°ú ÏÇ¨Í∏∞ÍæºÏùÑ ÎßåÎÇò Î∂ÄÏÉÅ
                    if (Math.random() < 0.5) {
                        character.injured = true;
                        message += " Í∑ºÎç∞ Í±∞Îûò ÎÅùÎÇòÍ≥† Îí§ÏóêÏÑú Ï¥ùÏùÑ ÏèòÎçîÎùºÍ≥†.";
                    }
                    return message;
                }
            },
            nurse: {
                name: 'Í∞ÑÌò∏',
                description: 'Ï∫†ÌîÑÏóê ÏûàÎäî Îã§Î•∏ Î™®Îì† Î∂ÄÏÉÅÏûêÏùò Î∂ÄÏÉÅÏùÑ ÌöåÎ≥µÏãúÌÇ®Îã§.',
                isAvailable: (character) => {
                    // Ï∫êÎ¶≠ÌÑ∞Í∞Ä Í∞ÑÌò∏Ìï† Ïàò ÏûàÎäî ÏÉÅÌÉúÏù∏ÏßÄ ÌôïÏù∏
                    if (character.dead || character.injured || character.depressed) return false;
                    
                    // Í∞ÑÌò∏Ìï† Î∂ÄÏÉÅÏûêÍ∞Ä ÏûàÎäîÏßÄ ÌôïÏù∏
                    let hasInjured = false;
                    gameState.characters.forEach(c => {
                        if (c.id !== character.id && c.injured && !c.dead) {
                            hasInjured = true;
                        }
                    });
                    return hasInjured;
                },
                execute: (character) => {
                    let healedCharacters = [];
                    
                    gameState.characters.forEach(c => {
                        if (c.id !== character.id && c.injured && !c.dead) {
                            c.injured = false;
                            healedCharacters.push(c.name);
                        }
                    });
                    
                    return `Î∂ÄÏÉÅÎãπÌïú ${healedCharacters.join(', ')}Î•º Í∞ÑÌò∏ÌñàÏñ¥.`;
                }
            },
            rest: {
                name: 'Ìú¥Ïãù',
                description: 'ÏûêÏã†Ïùò Ïö∞Ïö∏ÏùÑ ÏπòÎ£åÌïúÎã§.',
                isAvailable: (character) => !character.dead && character.depressed,
                execute: (character) => {
                    setDepressed(character, false);
                    return "Ìú¥ÏãùÏùÑ Ï∑®Ìï¥ÏÑú ÎßàÏùåÏù¥ Ìé∏ÏïàÌï¥Ï°åÏñ¥.";
                }
            },
            guard: {
                name: 'Í≤ΩÍ≥Ñ',
                description: 'Ï∫†ÌîÑÏùò Î∞©Ïñ¥ÎèÑÎ•º Ïò¨Î¶∞Îã§.',
                isAvailable: (character) => !character.dead && !character.injured && gameState.defense < 100,
                execute: (character) => {
                    let prefix = '';
                    let bonus = 0;
                    if (character.happy) {
                        prefix = '(Ïã±Í∏ÄÎ≤ôÍ∏Ä) ';
                        bonus = 1;
                    }
                    gameState.defense += gameState.defenseFortification + bonus;
                    if (gameState.defense > 100) gameState.defense = 100;
                    return `${prefix}Í≤ΩÍ≥ÑÎ•º ÏÑúÏÑú Ï∫†ÌîÑÏùò Î∞©Ïñ¥ÎèÑÎ•º ${gameState.defenseFortification + bonus}% Ïò¨Î†∏Ïñ¥.`;
                }
            },
            party: {
                name: 'ÌååÌã∞ Ï§ÄÎπÑ',
                description: 'üç∫Ïà† 1Í∞úÎ•º ÏÜåÎ™®Ìï¥ Î∞§Ïóê ÏûàÏùÑ ÌååÌã∞Î•º Ï§ÄÎπÑÌïúÎã§.',
                isAvailable: (character) => character.id === 'pilgeun' && !character.dead && gameState.resources.alcohol > 0,
                execute: (character) => {
                    // Ïà† ÏÜåÎ™®Îäî ÏÑ†ÌÉù Ïãú Ï≤òÎ¶¨
                    character.preparingParty = true;
                    return "Ïò§Îäò Î∞§ ÌååÌã∞Î•º Ï§ÄÎπÑÌñàÏñ¥!";
                }
            },
            build: {
                name: 'Í±¥ÏÑ§',
                description: 'üîßÎ∂ÄÌíà 1Í∞úÎ•º ÏÜåÎ™®Ìï¥ Î∞©Ïñ¥ÏãúÏÑ§ÏùÑ Í±¥ÏÑ§ÌïúÎã§.',
                isAvailable: (character) => !character.dead && gameState.resources.parts > 0,
                execute: (character) => {
                    // Î∂ÄÌíà ÏÜåÎ™®Îäî ÏÑ†ÌÉù Ïãú Ï≤òÎ¶¨
                    gameState.defenseFortification += 2;
                    return `Í±¥ÏÑ§ÏùÑ Ìï¥ÏÑú ÏïûÏúºÎ°ú Í≤ΩÍ≥ÑÎ•º ÏÑúÎ©¥ Î∞©Ïñ¥ÎèÑÍ∞Ä ${gameState.defenseFortification}% Ïò¨ÎùºÍ∞ÄÍ≤å ÎêêÏñ¥.`;
                }
            }
        };

        // DOM ÏöîÏÜå Ï¥àÍ∏∞Ìôî
        function initializeDOM() {
            // Ï∫êÎ¶≠ÌÑ∞ Ïπ¥Îìú ÏÉùÏÑ±
            const charactersContainer = document.getElementById('characters-container');
            charactersContainer.innerHTML = '';
            
            gameState.characters.forEach(character => {
                const card = createCharacterCard(character);
                charactersContainer.appendChild(card);
            });
            
            // ÌÑ¥ Ï¢ÖÎ£å Î≤ÑÌäº Ïù¥Î≤§Ìä∏
            document.getElementById('end-turn-button').addEventListener('click', endTurn);
            
            // Í≥ÑÏÜç Î≤ÑÌäº Ïù¥Î≤§Ìä∏
            document.getElementById('continue-night-button').addEventListener('click', continueNightEvents);
            
            // ÏûêÏõê Ìå®ÎÑê ÏóÖÎç∞Ïù¥Ìä∏
            updateResourcePanel();
            
            // Ìä∏Îü≠ Î∞è Î∞©Ïñ¥ÎèÑ ÏóÖÎç∞Ïù¥Ìä∏
            updateGameStatus();
        }

        // Ï∫êÎ¶≠ÌÑ∞ Ïπ¥Îìú ÏÉùÏÑ±
        function createCharacterCard(character) {
            const card = document.createElement('div');
            card.className = `character-card ${character.dead ? 'dead' : ''}`;
            card.id = `character-${character.id}`;
            
            card.innerHTML = `
                <div class="character-name">
                    <span>${character.name}</span>
                    ${character.action ? `<span class="selected-action">(${actions[character.action].name})</span>` : ''}
                </div>
                <div class="character-trait">${character.trait}</div>
                <div class="status-labels" id="status-${character.id}">
                    ${character.injured ? '<span class="status-label injured">Î∂ÄÏÉÅ</span>' : ''}
                    ${character.depressed ? '<span class="status-label depressed">Ïö∞Ïö∏</span>' : ''}
                    ${character.happy ? '<span class="status-label" style="background-color:var(--success-color);color:black;">ÌñâÎ≥µ</span>' : ''}
                    ${character.dead ? '<span class="status-label dead">ÏÇ¨Îßù</span>' : ''}
                </div>
                <div class="actions-container" id="actions-${character.id}">
                    <!-- ÌñâÎèô Î≤ÑÌäºÎì§Ïù¥ JavaScriptÎ°ú ÎèôÏ†Å ÏÉùÏÑ±Îê©ÎãàÎã§ -->
                </div>
            `;
            
            // Ï∫êÎ¶≠ÌÑ∞Í∞Ä Ï£ΩÏóàÏúºÎ©¥ ÌñâÎèô ÎπÑÌôúÏÑ±Ìôî
            if (!character.dead) {
                const actionsContainer = card.querySelector(`#actions-${character.id}`);
                
                // Í∞ÄÎä•Ìïú ÌñâÎèôÎì§ ÌëúÏãú
                Object.keys(actions).forEach(actionKey => {
                    const action = actions[actionKey];
                    
                    // Ìï¥Îãπ Ï∫êÎ¶≠ÌÑ∞Í∞Ä Ìï† Ïàò ÏûàÎäî ÌñâÎèôÏù∏ÏßÄ ÌôïÏù∏
                    if (action.isAvailable(character)) {
                        const button = document.createElement('button');
                        button.className = 'action-button';
                        button.textContent = action.name;
                        button.disabled = character.action !== null;
                        
                        // Ìà¥ÌÅ¨ Ï∂îÍ∞Ä
                        const tooltip = document.createElement('div');
                        tooltip.className = 'action-tooltip';
                        tooltip.textContent = action.description;
                        button.appendChild(tooltip);
                        
                        // ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏
                        button.addEventListener('click', () => {
                            selectAction(character, actionKey);
                        });
                        
                        actionsContainer.appendChild(button);
                    }
                });
            }
            
            return card;
        }

        // ÌñâÎèô ÏÑ†ÌÉù
        function selectAction(character, actionKey) {
            character.action = actionKey;
            // ÌååÌã∞ Ï§ÄÎπÑÎÇò Í±¥ÏÑ§Ï≤òÎüº ÏûêÏõêÏùÑ ÏÜåÎ™®ÌïòÎäî ÌñâÎèôÏùÄ ÏÑ†ÌÉù Ï¶âÏãú ÏûêÏõê Ï∞®Í∞ê
            if (actionKey === 'party') {
                if (gameState.resources.alcohol > 0) {
                    gameState.resources.alcohol -= 1;
                }
            }
            if (actionKey === 'build') {
                if (gameState.resources.parts > 0) {
                    gameState.resources.parts -= 1;
                }
            }
            // Î≤ÑÌäº ÎπÑÌôúÏÑ±Ìôî
            const actionsContainer = document.querySelector(`#actions-${character.id}`);
            const buttons = actionsContainer.querySelectorAll('.action-button');
            buttons.forEach(button => {
                button.disabled = true;
            });
            // ÌÑ¥ Ï¢ÖÎ£å Î≤ÑÌäº ÌôúÏÑ±Ìôî Ïó¨Î∂Ä Ï≤¥ÌÅ¨
            checkEndTurnButton();
            // ÏûêÏõê Ìå®ÎÑê Ï¶âÏãú Í∞±Ïã†
            updateResourcePanel();
        }

        // ÌÑ¥ Ï¢ÖÎ£å Î≤ÑÌäº ÌôúÏÑ±Ìôî Ïó¨Î∂Ä Ï≤¥ÌÅ¨
        function checkEndTurnButton() {
            const endTurnButton = document.getElementById('end-turn-button');
            
            // ÏÇ¥ÏïÑÏûàÎäî Î™®Îì† Ï∫êÎ¶≠ÌÑ∞Í∞Ä ÌñâÎèôÏùÑ ÏÑ†ÌÉùÌñàÎäîÏßÄ ÌôïÏù∏
            const allSelected = gameState.characters.every(character => 
                character.dead || character.action !== null
            );
            
            endTurnButton.disabled = !allSelected;
        }

        // ÌÑ¥ Ï¢ÖÎ£å
        function endTurn() {
            gameState.isNight = true;
            document.getElementById('time-period').textContent = 'Î∞§';
            
            // Î∞§ Ïù¥Î≤§Ìä∏ Î©îÏãúÏßÄ Ï¥àÍ∏∞Ìôî
            gameState.nightMessages = [];
            gameState.currentMessageIndex = 0;
            
            // Í∞Å Ï∫êÎ¶≠ÌÑ∞Ïùò ÌñâÎèô Í≤∞Í≥º Ï≤òÎ¶¨
            gameState.characters.forEach(character => {
                if (!character.dead && character.action !== null) {
                    const action = actions[character.action];
                    const result = action.execute(character);
                    gameState.nightMessages.push(`${character.name}: ${result}`);
                }
                
                // ÌñâÎèô Ï¥àÍ∏∞Ìôî
                character.action = null;
            });
            
            // ÏãùÎüâ ÏÜåÎπÑ
            consumeFood();
            
            // Î∞©Ïñ¥ÎèÑ ÌïòÎùΩ
            gameState.defense -= (gameState.day >= 14 ? 10 : 5);
            if (gameState.defense < 0) gameState.defense = 0;
            
            // Î∞§ Ïù¥Î≤§Ìä∏ Ï≤¥ÌÅ¨
            checkNightEvents();
            
            // Îã§Ïùå ÌÑ¥ Ï§ÄÎπÑ
            updateResourcePanel();
            updateGameStatus();
            
            // Î©îÏãúÏßÄ Î°úÍ∑∏Ïóê ÎÇ†Ïßú Ï∂îÍ∞Ä
            addToMessageLog(`===== ${gameState.day}ÏùºÏ∞® Î∞§ =====`);
            
            // Î∞§ Ïù¥Î≤§Ìä∏ Î™®Îã¨ ÏãúÏûë
            startNightEvents();
        }

        // ÏãùÎüâ ÏÜåÎπÑ
        function consumeFood() {
            // Ï∫êÎ¶≠ÌÑ∞ ÏàúÏÑú: Ï†ïÏú§ÏßÄ - Ïã†ÏÑúÌòÑ - Ï∞®ÌïÑÍ∑º - Ïò§ÏÑ±Íµ≠
            const order = ['yoonji', 'seohyun', 'pilgeun', 'sungkook'];
            
            for (const id of order) {
                const character = gameState.characters.find(c => c.id === id);
                
                if (!character.dead) {
                    // Ïò§ÏÑ±Íµ≠ÏùÄ ÏãùÎüâ 2Í∞ú ÏÜåÎπÑ
                    const neededFood = character.id === 'sungkook' ? 2 : 1;
                    
                    if (character.id === 'yoonji') {
                        // Ïú§ÏßÄÎäî ÏïºÏ±ÑÎßå Î®πÏùå
                        if (gameState.resources.vegetables >= neededFood) {
                            gameState.resources.vegetables -= neededFood;
                        } else {
                            // ÏãùÎüâ Î∂ÄÏ°±
                            gameState.nightMessages.push(`${character.name}: ÏïºÏ±Ñ ÏïÑÎãàÎ©¥ Ïïà Î®πÏùÑÎûò...`);
                            makeDepressed(character);
                        }
                    } else {
                        // Îã§Î•∏ Ï∫êÎ¶≠ÌÑ∞Îì§ÏùÄ Í≥†Í∏∞ Ïö∞ÏÑ†, Î∂ÄÏ°±ÌïòÎ©¥ ÏïºÏ±Ñ
                        if (gameState.resources.meat >= neededFood) {
                            gameState.resources.meat -= neededFood;
                        } else if (gameState.resources.vegetables >= neededFood) {
                            gameState.resources.vegetables -= neededFood;
                        } else if (gameState.resources.meat + gameState.resources.vegetables >= neededFood) {
                            // ÌòºÌï© ÏãùÎüâ
                            const usedMeat = Math.min(gameState.resources.meat, neededFood);
                            gameState.resources.meat -= usedMeat;
                            gameState.resources.vegetables -= (neededFood - usedMeat);
                        } else {
                            // ÏãùÎüâ Î∂ÄÏ°±
                            gameState.nightMessages.push(`${character.name}: ÏãùÎüâÏù¥ Î∂ÄÏ°±Ìï¥ÏÑú Íµ∂ÏóàÏñ¥...`);
                            makeDepressed(character);
                        }
                    }
                }
            }
        }

        // Ï∫êÎ¶≠ÌÑ∞ ÏÉÅÌÉú Î≥ÄÍ≤Ω Ìï®ÏàòÎì§
        function setDepressed(character, value) {
            if (value === true) {
                // Ïö∞Ïö∏Ìï¥Ïßà Îïå ÌñâÎ≥µ ÏÉÅÌÉúÎ•º Î®ºÏ†Ä Ï†úÍ±∞
                character.happy = false;
            }
            character.depressed = value;
        }
        
        function setHappy(character, value) {
            if (value === true) {
                // ÌñâÎ≥µÌï¥Ïßà Îïå Ïö∞Ïö∏ ÏÉÅÌÉúÎ•º Î®ºÏ†Ä Ï†úÍ±∞
                character.depressed = false;
            }
            character.happy = value;
        }
        
        function setInjured(character, value) {
            character.injured = value;
        }

        // Ï∫êÎ¶≠ÌÑ∞ Ïö∞Ïö∏ÌïòÍ≤å ÎßåÎì¶
        function makeDepressed(character) {
            if (character.happy) {
                setHappy(character, false);
                gameState.nightMessages.push(`${character.name}: ${character.name} Ïù¥Ï†ú Ïïà ÌñâÎ≥µÌï¥...`);
                return;
            }
            if (Math.random() < 0.5) {
                if (!character.depressed) {
                    setDepressed(character, true);
                    gameState.nightMessages.push(`${character.name}: Ïö∞Ïö∏Ìï¥Ï°åÏñ¥...`);
                } else {
                    character.dead = true;
                    gameState.nightMessages.push(`${character.name}: ÎØ∏Ïïà, ÏπúÍµ¨Îì§. ÎÇò Í∞ôÏùÄ Ïì∞Î†àÍ∏∞Í∞Ä ÏÇ¥ÏïÑÏÑú Î≠êÌïòÍ≤†Ïñ¥. Ïûò ÏûàÏñ¥.`);
                    handleCharacterDeath();
                }
            }
        }

        // Ï∫êÎ¶≠ÌÑ∞ Î∂ÄÏÉÅ ÏûÖÌûò
        function makeInjured(character) {
            if (character.happy) {
                setHappy(character, false);
                gameState.nightMessages.push(`${character.name}: ÌñâÎ≥µÏù¥ ÏÇ¨ÎùºÏ°åÏñ¥...`);
            }
            if (!character.injured) {
                setInjured(character, true);
                gameState.nightMessages.push(`${character.name}: Î∂ÄÏÉÅÏùÑ ÏûÖÏóàÏñ¥...`);
            } else {
                character.dead = true;
                gameState.nightMessages.push(`${character.name}: Ïª§Ìóâ! (Ìîº ÌÜ†ÌïòÎäî ÏÜåÎ¶¨)`);
                handleCharacterDeath();
            }
        }

        // Ï∫êÎ¶≠ÌÑ∞ ÏÇ¨Îßù Ï≤òÎ¶¨
        function handleCharacterDeath() {
            // Îã§Î•∏ Ï∫êÎ¶≠ÌÑ∞Îì§ 50% ÌôïÎ•†Î°ú Ïö∞Ïö∏
            gameState.characters.forEach(character => {
                if (!character.dead && Math.random() < 0.5) {
                    if (!character.depressed) {
                        setDepressed(character, true);
                        // Í∞ÄÏû• ÏµúÍ∑ºÏóê Ï£ΩÏùÄ Ï∫êÎ¶≠ÌÑ∞ Ï∞æÍ∏∞
                        const recentlyDeadCharacters = gameState.characters.filter(c => c.dead && !c.wasProcessed);
                        if (recentlyDeadCharacters.length > 0) {
                            // Í∞ÄÏû• ÏµúÍ∑ºÏóê Ï£ΩÏùÄ Ï∫êÎ¶≠ÌÑ∞ ÏÑ†ÌÉù
                            const deadCharacter = recentlyDeadCharacters[recentlyDeadCharacters.length - 1];
                            deadCharacter.wasProcessed = true; // Ïù¥ÎØ∏ Ïñ∏Í∏âÎêú Ï∫êÎ¶≠ÌÑ∞ ÌëúÏãú
                            gameState.nightMessages.push(`${character.name}: ${deadCharacter.name}Ïù¥Í∞Ä Ï£ΩÎã§Îãà...`);
                        } else {
                            // Ï£ΩÏùÄ Ï∫êÎ¶≠ÌÑ∞Î•º ÌäπÏ†ïÌï† Ïàò ÏóÜÎäî Í≤ΩÏö∞ Í∏∞Î≥∏ Î©îÏãúÏßÄ
                            gameState.nightMessages.push(`${character.name}: ÎÑàÎ¨¥ Ïä¨Ìçº...`);
                        }
                    }
                }
            });
            
            // Í≤åÏûÑ Ïò§Î≤Ñ Ï≤¥ÌÅ¨
            checkGameOver();
        }

        // Î∞§ Ïù¥Î≤§Ìä∏ Ï≤¥ÌÅ¨
        function checkNightEvents() {
            // ÏäµÍ≤© Ï≤¥ÌÅ¨ (Î∞©Ïñ¥ÎèÑÏùò ÌôïÎ•†Î°ú ÏäµÍ≤© ÏóÜÏùå)
            if (Math.random() > gameState.defense / 100) {
                // ÏäµÍ≤© Î∞úÏÉù
                gameState.nightMessages.push("Í∞±Îã®Ïù¥ ÏäµÍ≤©Ìï¥ÏôîÎã§!");
                
                // ÏÑ±Íµ≠Ïù¥ ÏÇ¥ÏïÑÏûàÍ≥† Î∂ÄÏÉÅÏù¥ ÏïÑÎãàÎùºÎ©¥ 25% ÌôïÎ•†Î°ú Í≤©Ìá¥
                const sungkook = gameState.characters.find(c => c.id === 'sungkook');
                if (sungkook && !sungkook.dead && !sungkook.injured && Math.random() < 0.25) {
                    gameState.nightMessages.push("Ïò§ÏÑ±Íµ≠: Í±±Ï†ï Îßà! ÎÇ¥Í∞Ä Í≤©Ìá¥ÌñàÏñ¥!");
                    // Í≤©Ìá¥ ÏÑ±Í≥µ Ïãú Î∂ÄÏÉÅÏûê ÏóÜÏùå
                } else {
                    // ÌååÌã∞Í∞Ä Ï§ÄÎπÑÎêòÏñ¥ ÏûàÏóàÎã§Î©¥ Ï∑®ÏÜå
                    const pilgeun = gameState.characters.find(c => c.id === 'pilgeun');
                    if (pilgeun?.preparingParty) {
                        gameState.nightMessages.push("ÌååÌã∞Îäî Ï∑®ÏÜåÎêêÎã§!");
                        pilgeun.preparingParty = false;
                    }
                    
                    // ÏÇ¥ÏïÑÏûàÎäî ÏÇ¨Îûå Ï§ë Ìïú Î™Ö Î∂ÄÏÉÅ
                    const livingCharacters = gameState.characters.filter(c => !c.dead);
                    if (livingCharacters.length > 0) {
                        const victimIndex = Math.floor(Math.random() * livingCharacters.length);
                        const victim = livingCharacters[victimIndex];
                        makeInjured(victim);
                    }
                       // Î∞©Ïñ¥ÎèÑÍ∞Ä ÎÇÆÏùÑÏàòÎ°ù Ìä∏Îü≠ Í≥µÍ≤© ÌôïÎ•† Ï¶ùÍ∞Ä (Î∞©Ïñ¥ÎèÑ 30% Ïù¥ÌïòÎ©¥ 70% ÌôïÎ•†Î°ú Ìä∏Îü≠ Í≥µÍ≤©)
                       if (Math.random() > gameState.defense / 100) {
                        const damage = Math.floor(Math.random() * 10) + 1; // 1-10 Îç∞ÎØ∏ÏßÄ
                        gameState.truckDurability -= damage;
                        
                        // ÎûúÎç§ ÏÉùÏ°¥ÏûêÍ∞Ä Ìä∏Îü≠ Í≥µÍ≤© ÏÉÅÌô© Î≥¥Í≥†
                        const livingChars = gameState.characters.filter(c => !c.dead);
                        if (livingChars.length > 0) {
                            const reporter = livingChars[Math.floor(Math.random() * livingChars.length)];
                            gameState.nightMessages.push(`${reporter.name}: ÎÜàÎì§Ïù¥ Ìä∏Îü≠ÍπåÏßÄ Í≥µÍ≤©ÌñàÏñ¥!`);
                        }
                    }
                }
            } else if (gameState.characters.find(c => c.id === 'pilgeun')?.preparingParty) {
                // ÌååÌã∞ Ï§ÄÎπÑÌñàÍ≥† ÏäµÍ≤©Ïù¥ ÏóÜÏóàÏùå
                gameState.nightMessages.push("Ï∞®ÌïÑÍ∑ºÏù¥ Ï§ÄÎπÑÌñàÎã§Îäî ÌååÌã∞Í∞Ä ÏãúÏûëÎêêÎã§!");
                
                // ÎûúÎç§ÌïòÍ≤å 3Í∞úÏùò ÎåÄÏÇ¨ Ï§ë ÌïòÎÇò ÏÑ†ÌÉù
                const partyMessages = [
                    "Ï∞®ÌïÑÍ∑º: Îã§Í∞ôÏù¥ Ïö∞Î¶¨ Î∞òÏßÄÌïòÏùò ÎØ∏ÎûòÎ•º Ïä§ÏºÄÏπòÎ∂ÅÏóê Í∑∏Î†§Î≥ºÍπåÏöî?",
                    "Ï∞®ÌïÑÍ∑º: Ï†úÍ∞Ä ÌîºÏïÑÎÖ∏Î•º Ïó∞Ï£ºÌï¥ÎìúÎ¶¥Í≤åÏöî! (Îî©Îî©Îî©)",
                    "Ï∞®ÌïÑÍ∑º: (Ïó¥Ï∞ΩÌïòÎ©∞) ÏïïÎëòÎ∞î~ ÏïïÎëòÎ∞î~ ÏïïÎëòÎ∞î~"
                ];
                const randomMessage = partyMessages[Math.floor(Math.random() * partyMessages.length)];
                gameState.nightMessages.push(randomMessage);
                
                // Î™®Îì† Ï∫êÎ¶≠ÌÑ∞Ïùò Ïö∞Ïö∏ ÌöåÎ≥µ
                gameState.characters.forEach(character => {
                    if (!character.dead && character.depressed) {
                        setDepressed(character, false);
                        gameState.nightMessages.push(`${character.name}: Ïö∞Ïö∏Ìï®Ïù¥ ÏÇ¨ÎùºÏ°åÏñ¥!`);
                    }
                });
                // ÌååÌã∞ ÏÑ±Í≥µ Ïãú ÎûúÎç§ ÏÉùÏ°¥Ïûê 1Î™ÖÏóêÍ≤å ÌñâÎ≥µ Î∂ÄÏó¨
                const living = gameState.characters.filter(c => !c.dead);
                if (living.length > 0) {
                    const lucky = living[Math.floor(Math.random() * living.length)];
                    setHappy(lucky, true);
                    gameState.nightMessages.push(`${lucky.name}: ${lucky.name} ÌñâÎ≥µÌï¥! Î≠êÎì†ÏßÄ Ìï¥ÎÇº Ïàò ÏûàÏùÑ Í≤ÉÎßå Í∞ôÏïÑ!`);
                }
            }
            
            // ÌååÌã∞ Ï§ÄÎπÑ ÏÉÅÌÉú Ï¥àÍ∏∞Ìôî
            const pilgeun = gameState.characters.find(c => c.id === 'pilgeun');
            if (pilgeun) {
                pilgeun.preparingParty = false;
            }
        }

        // Î∞§ Ïù¥Î≤§Ìä∏ ÏãúÏûë
        function startNightEvents() {
            if (gameState.nightMessages.length > 0) {
                const modal = document.getElementById('night-events-modal');
                const message = document.getElementById('night-event-message');
                message.textContent = gameState.nightMessages[gameState.currentMessageIndex];
                modal.style.display = 'flex';
            } else {
                goToNextDay();
            }
        }

        // Î∞§ Ïù¥Î≤§Ìä∏ Í≥ÑÏÜç
        function continueNightEvents() {
            gameState.currentMessageIndex++;
            
            if (gameState.currentMessageIndex < gameState.nightMessages.length) {
                const message = document.getElementById('night-event-message');
                message.textContent = gameState.nightMessages[gameState.currentMessageIndex];
            } else {
                const modal = document.getElementById('night-events-modal');
                modal.style.display = 'none';
                goToNextDay();
            }
        }

        // Îã§Ïùå ÎÇ†Î°ú
        function goToNextDay() {
            gameState.day++;
            gameState.isNight = false;
            document.getElementById('time-period').textContent = 'ÎÇÆ';
            
            // Î©îÏãúÏßÄ Î°úÍ∑∏Ïóê ÎÇ†Ïßú Ï∂îÍ∞Ä
            addToMessageLog(`===== ${gameState.day}ÏùºÏ∞® ÎÇÆ =====`);
            
            // ÏãùÎüâ Î∂ÄÏ°± Ï≤¥ÌÅ¨
            const totalMeat = gameState.resources.meat;
            const totalVegetables = gameState.resources.vegetables;
            
            // ÌïÑÏöîÌïú ÏãùÎüâ Í≥ÑÏÇ∞ (Í∏∞Î≥∏Ï†ÅÏúºÎ°ú ÏÉùÏ°¥Ïûê 1Î™ÖÎãπ 1Í∞úÏî©)
            let requiredFood = 0;
            gameState.characters.forEach(character => {
                if (!character.dead) {
                    // Ïò§ÏÑ±Íµ≠ÏùÄ ÏãùÎüâÏùÑ 2Í∞ú ÏÜåÎπÑ
                    requiredFood += (character.id === 'sungkook') ? 2 : 1;
                }
            });
            
            // ÏãùÎüâ Î∂ÄÏ°± Í≤ΩÍ≥†
            if (totalMeat + totalVegetables < requiredFood) {
                // ÏÇ¥ÏïÑÏûàÎäî Ï∫êÎ¶≠ÌÑ∞ Ï§ë ÎûúÎç§ÏúºÎ°ú Ìïú Î™Ö ÏÑ†ÌÉù
                const livingCharacters = gameState.characters.filter(c => !c.dead);
                if (livingCharacters.length > 0) {
                    const randomIndex = Math.floor(Math.random() * livingCharacters.length);
                    const warningCharacter = livingCharacters[randomIndex];
                    addToMessageLog(`${warningCharacter.name}: ÏãùÎüâÏù¥ Î∂ÄÏ°±Ìï¥. Ïù¥Îü¨Îã§ Íµ∂Í≤†Ïñ¥.`);
                }
            }
            
            // Ï∫êÎ¶≠ÌÑ∞ ÏóÖÎç∞Ïù¥Ìä∏
            gameState.characters.forEach(character => {
                const card = document.getElementById(`character-${character.id}`);
                if (character.dead) {
                    card.classList.add('dead');
                } else {
                    // ÏÉÅÌÉú ÎùºÎ≤® ÏóÖÎç∞Ïù¥Ìä∏
                    const statusContainer = document.getElementById(`status-${character.id}`);
                    statusContainer.innerHTML = '';
                    if (character.injured) {
                        const label = document.createElement('span');
                        label.className = 'status-label injured';
                        label.textContent = 'Î∂ÄÏÉÅ';
                        statusContainer.appendChild(label);
                    }
                    if (character.depressed) {
                        const label = document.createElement('span');
                        label.className = 'status-label depressed';
                        label.textContent = 'Ïö∞Ïö∏';
                        statusContainer.appendChild(label);
                    }
                    if (character.happy) {
                        const label = document.createElement('span');
                        label.className = 'status-label';
                        label.style.backgroundColor = 'var(--success-color)';
                        label.style.color = 'black';
                        label.textContent = 'ÌñâÎ≥µ';
                        statusContainer.appendChild(label);
                    }
                }
            });
            
            // ÌñâÎèô Î≤ÑÌäº Ï¥àÍ∏∞Ìôî
            initializeDOM();
            
            // Í≤åÏûÑ ÌÅ¥Î¶¨Ïñ¥ Ï≤¥ÌÅ¨
            if (gameState.truckDurability >= 100) {
                endGame(true);
            }
        }

        // Í≤åÏûÑ Ïò§Î≤Ñ Ï≤¥ÌÅ¨
        function checkGameOver() {
            const allDead = gameState.characters.every(character => character.dead);
            if (allDead) {
                endGame(false);
            }
        }

        // Í≤åÏûÑ Ï¢ÖÎ£å
        function endGame(victory) {
            const modal = document.getElementById('game-over-modal');
            const title = document.getElementById('modal-title');
            const message = document.getElementById('modal-message');
            
            if (victory) {
                title.textContent = 'ÌÉàÏ∂ú!';
                
                // ÏÉùÏ°¥Ïûê Ïàò ÌôïÏù∏ Î∞è Îû≠ÌÅ¨ Î∂ÄÏó¨
                const survivors = gameState.characters.filter(character => !character.dead);
                const survivorNames = survivors.map(character => character.name).join(', ');
                let rank = '';
                
                if (survivors.length === 4) {
                    rank = 'S';
                } else if (survivors.length === 3) {
                    rank = 'A';
                } else if (survivors.length === 2) {
                    rank = 'B';
                } else if (survivors.length === 1) {
                    rank = 'C';
                }
                
                message.textContent = `${gameState.day}Ïùº ÎßåÏóê ÏúÑÌóò ÏßÄÏó≠ÏùÑ ÌÉàÏ∂úÌñàÏäµÎãàÎã§. 
ÏÉùÏ°¥Ïûê: ${survivorNames} (${rank}Îû≠ÌÅ¨)`;
            } else {
                title.textContent = 'Ìå®Î∞∞...';
                message.textContent = 'Î™®Îì† ÏÉùÏ°¥ÏûêÍ∞Ä Ï£ΩÏóàÏäµÎãàÎã§...';
            }
            
            modal.style.display = 'flex';
        }

        // Í≤åÏûÑ Ïû¨ÏãúÏûë
        function restartGame() {
            location.reload();
        }

        // ÏûêÏõê Ìå®ÎÑê ÏóÖÎç∞Ïù¥Ìä∏
        function updateResourcePanel() {
            document.getElementById('meat-value').textContent = gameState.resources.meat;
            document.getElementById('vegetables-value').textContent = gameState.resources.vegetables;
            document.getElementById('parts-value').textContent = gameState.resources.parts;
            document.getElementById('alcohol-value').textContent = gameState.resources.alcohol;
        }

        // Í≤åÏûÑ ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
        function updateGameStatus() {
            document.getElementById('day-value').textContent = gameState.day;
            document.getElementById('truck-value').textContent = `${gameState.truckDurability}%`;
            document.getElementById('defense-value').textContent = `${gameState.defense}%`;
            
            document.getElementById('truck-bar').style.width = `${gameState.truckDurability}%`;
            document.getElementById('defense-bar').style.width = `${gameState.defense}%`;
        }

        // Î©îÏãúÏßÄ Î°úÍ∑∏Ïóê Ï∂îÍ∞Ä
        function addToMessageLog(message) {
            const messageLog = document.getElementById('message-log');
            const messageElement = document.createElement('div');
            messageElement.className = 'message';
            messageElement.textContent = message;
            messageLog.appendChild(messageElement);
            messageLog.scrollTop = messageLog.scrollHeight;
        }

        // Í≤åÏûÑ Ï¥àÍ∏∞Ìôî Î∞è ÏãúÏûë
        window.onload = function() {
            initializeDOM();
        };
    </script>
</body>
</html>